# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the official TypeScript SDK for [speechall.com](https://speechall.com), a speech-to-text API supporting multiple providers (OpenAI Whisper, Deepgram, AssemblyAI, RevAI, Amazon Transcribe, etc.).

**The SDK is auto-generated using [Fern](https://buildwithfern.com) from an OpenAPI specification. Do not manually edit files in `src/`.**

## Common Commands

```bash
# Build
npm run build           # Compile TypeScript to dist/

# Test
npm test                # Run all tests
npm run test:unit       # Unit tests only
npm run test:integration  # Integration tests (requires SPEECHALL_API_TOKEN env var)
npm run test:coverage   # Tests with coverage report

# SDK Regeneration (after OpenAPI spec changes)
./regenerate.sh         # Recommended: validates, generates, type-checks, and tests
fern generate --local --force  # Manual generation
fern check              # Validate OpenAPI spec

# Run examples (requires npm run build first)
npx tsx examples/basic-transcription.ts  # Use tsx, not ts-node
```

## Release Process

### Automated Release Workflow

**The release process is fully automated.** When you push a version bump to `main`, GitHub Actions automatically creates a GitHub Release and publishes to npm.

```bash
# 1. Update version in fern/generators.yml
# Edit line 29: version: X.Y.Z

# 2. Update version in package.json
# Edit line 3: "version": "X.Y.Z"

# 3. Add CHANGELOG entry
# Add new section at top of CHANGELOG.md

# 4. Commit and push to main
git add fern/generators.yml package.json CHANGELOG.md
git commit -m "chore: bump version to X.Y.Z"
git push origin main

# Automatic flow triggers:
# → auto-release.yml detects package.json change
# → Creates GitHub Release vX.Y.Z
# → Triggers repository_dispatch event
# → release.yml publishes to npm
```

### npm Trusted Publishing

**Authentication:** Uses OIDC Trusted Publishing (no long-lived tokens needed)

**Requirements:**
- npm CLI version 11.5.1+ (enforced in workflow)
- Trusted Publisher configured on npmjs.org for `@speechall/sdk`
- GitHub Actions permissions: `id-token: write`

**Configuration on npmjs.org:**
- Repository: `Speechall/speechall-typescript-sdk`
- Workflow: `release.yml`
- Environment: (none)

**If npm publish fails:**
1. Verify Trusted Publisher is configured correctly on npmjs.org
2. Check that you have admin access to `@speechall` npm organization
3. Ensure npm version is 11.5.1+ (workflow installs latest automatically)
4. Verify `id-token: write` permission in `.github/workflows/release.yml`

### Manual Version Bump Notes

- **fern/generators.yml** (line 29) controls the version in generated code
- **package.json** may need manual update (Fern only regenerates `src/`)
- **CHANGELOG.md** follows [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format

## Architecture

### Code Generation Flow
```
OpenAPI spec → Fern generator → src/ (TypeScript) → npm run build → dist/ (JavaScript)
```

Configuration: `fern/generators.yml` controls SDK generation options.

### Client Structure
```typescript
SpeechallClient
├── speechToText              // Main transcription API
│   ├── transcribe()          // Local audio file
│   ├── transcribeRemote()    // Remote URL
│   └── listSpeechToTextModels()
└── replacementRules          // Text replacement rulesets
    └── create()
```

### Key Directories
- `src/` - Generated TypeScript source (do not edit)
- `dist/` - Compiled JavaScript output
- `fern/` - Fern configuration (`generators.yml`, `fern.config.json`)
- `tests/` - Jest tests (unit and integration)
- `examples/` - Usage examples

### Protected Files (not overwritten by Fern)
See `.fernignore`: tests/, examples/, tsconfig.json, jest.config.js, README.md

### Regenerated Files
- `src/` - Fully regenerated by Fern
- `package.json` - Metadata from `fern/generators.yml` packageJson config

## Error Types

SDK provides typed errors for HTTP status codes:
- `BadRequestError` (400), `UnauthorizedError` (401), `PaymentRequiredError` (402)
- `NotFoundError` (404), `TooManyRequestsError` (429)
- `InternalServerError` (500), `ServiceUnavailableError` (503), `GatewayTimeoutError` (504)
- `SpeechallTimeoutError` - Request timeout
- `SpeechallError` - Base error class

@AGENTS.md
